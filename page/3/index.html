<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>chenhy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="keep learning">
<meta property="og:type" content="website">
<meta property="og:title" content="chenhy's blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="chenhy's blog">
<meta property="og:description" content="keep learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="chenhy's blog">
<meta name="twitter:description" content="keep learning">
  
    <link rel="alternative" href="/atom.xml" title="chenhy&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://odizoogtm.bkt.clouddn.com/Octocat_GitHub.png?imageView2/2/w/300" class="js-avatar show">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">chenhy</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/categories/essay">随笔</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/chhy2009" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
								<a class="linkedin" target="_blank" href="#" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/IPD-process/" style="font-size: 10px;">IPD process</a> <a href="/tags/Linux-signal/" style="font-size: 10px;">Linux signal</a> <a href="/tags/Makefile/" style="font-size: 10px;">Makefile</a> <a href="/tags/Markdown/" style="font-size: 20px;">Markdown</a> <a href="/tags/TCP-IP/" style="font-size: 20px;">TCP/IP</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/compile-and-debug-tools/" style="font-size: 10px;">compile and debug tools</a> <a href="/tags/design-pattern/" style="font-size: 10px;">design pattern</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/keepalive/" style="font-size: 10px;">keepalive</a> <a href="/tags/kernel-modules/" style="font-size: 10px;">kernel modules</a> <a href="/tags/lex/" style="font-size: 10px;">lex</a> <a href="/tags/mac-shortcut/" style="font-size: 10px;">mac shortcut</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/openssl/" style="font-size: 15px;">openssl</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/redis/" style="font-size: 20px;">redis</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/syslog/" style="font-size: 10px;">syslog</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/visual-studio/" style="font-size: 10px;">visual studio</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/yacc/" style="font-size: 10px;">yacc</a> <a href="/tags/算法，排序/" style="font-size: 10px;">算法，排序</a> <a href="/tags/论坛/" style="font-size: 10px;">论坛</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a> <a href="/tags/非阻塞connect/" style="font-size: 10px;">非阻塞connect</a> <a href="/tags/［googletest-unit-test］/" style="font-size: 10px;">［googletest, unit test］</a> <a href="/tags/［python］/" style="font-size: 10px;">［python］</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/codingcs">我的csdn博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">程序员，编程爱好者</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">chenhy</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img lazy-src="/http://odizoogtm.bkt.clouddn.com/Octocat_GitHub.png?imageView2/2/w/300" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">chenhy</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/essay">随笔</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/chhy2009" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
						<a class="linkedin" target="_blank" href="#" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-c_c++/signal" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/20/c_c++/signal/" class="article-date">
  	<time datetime="2017-02-20T00:32:41.000Z" itemprop="datePublished">2017-02-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/20/c_c++/signal/">信号处理机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用信号"><span class="toc-text">常用信号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#信号集"><span class="toc-text">信号集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#信号处理函数"><span class="toc-text">信号处理函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#阻塞信号"><span class="toc-text">阻塞信号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#产生信号函数"><span class="toc-text">产生信号函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#睡眠函数及定时器"><span class="toc-text">睡眠函数及定时器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程与信号"><span class="toc-text">线程与信号</span></a></li></ol>
</div>

         
        <h2 id="常用信号"><a href="#常用信号" class="headerlink" title="常用信号"></a>常用信号</h2><p>信号定义在<signal.h>文件中，可以通过在shell下键入kill –l查看信号列表，或者man 7 signal查看说明。<br>    不能忽略的信号：SIGKILL及SIGSTOP 这两个信号是不能忽略的，即进程接收到这两个信号后，只能接受系统的默认处理，及终止进行。<br>    中断信号：SIGINT(ctrl+c触发)，SIGQIUT(ctrl+\触发)  </signal.h></p>
<h2 id="信号集"><a href="#信号集" class="headerlink" title="信号集"></a>信号集</h2><p>POSIX.1 定义数据类型sigset_t用于表示一个信号集，并且定义了以下的一组信号能对sigset_t结构体进行处理的函数，用于初始化及增删信号集：  </p>
<pre><code class="c"><span class="function"><span class="keyword">int</span> <span class="title">sigemptyset</span><span class="params">(<span class="keyword">sigset_t</span> *<span class="built_in">set</span>)</span></span>;      <span class="comment">//清空信号集合set</span>
<span class="function"><span class="keyword">int</span> <span class="title">sigfillset</span><span class="params">(<span class="keyword">sigset_t</span> *<span class="built_in">set</span>)</span></span>;      <span class="comment">//将所有信号填充进set中</span>
<span class="function"><span class="keyword">int</span> <span class="title">sigaddset</span><span class="params">(<span class="keyword">sigset_t</span> *<span class="built_in">set</span>, <span class="keyword">int</span> signum)</span></span>;    <span class="comment">//往set中添加信号signum</span>
<span class="function"><span class="keyword">int</span> <span class="title">sigdelset</span><span class="params">(<span class="keyword">sigset_t</span> *<span class="built_in">set</span>, <span class="keyword">int</span> signum)</span></span>;    <span class="comment">//从set中移除信号signum</span>
<span class="function"><span class="keyword">int</span> <span class="title">sigismember</span><span class="params">(<span class="keyword">const</span> <span class="keyword">sigset_t</span> *<span class="built_in">set</span>, <span class="keyword">int</span> signum)</span></span>; <span class="comment">//判断signnum是不是包含在set中</span>
<span class="function"><span class="keyword">int</span> <span class="title">sigpending</span><span class="params">(<span class="keyword">sigset_t</span> *<span class="built_in">set</span>)</span></span>;  <span class="comment">//返回一信号集</span>
</code></pre>
<h2 id="信号处理函数"><a href="#信号处理函数" class="headerlink" title="信号处理函数"></a>信号处理函数</h2><ol>
<li><p>signal<br>其不能处理当正在执行信号处理函数期间又触发相同信号的情况。<br>对应的信号处理函数：void handler(int)</p>
</li>
<li><p>sigaction<br>其为signal函数的升级版，此函数取代了unix早期版本使用的signal函数。其原型如下：<br><code>int sigaction(int signo, const struct sigaction *act, struct sigaction *oldact);</code><br>其中，signo是要检测或修改其具体动作的信号编号，act指针是需要设置的动作参数，oact参数用于存放该信号的上一个动作。其中struct sigation定义如下：  </p>
</li>
</ol>
<pre><code class="c"><span class="keyword">struct</span>  sigaction {
             <span class="keyword">void</span> (*sa_handler)(<span class="keyword">int</span>);  <span class="comment">/* signal handler */</span>
             <span class="keyword">void</span> (*sa_sigaction)(<span class="keyword">int</span>, <span class="keyword">siginfo_t</span> *, <span class="keyword">void</span> *);
             <span class="keyword">sigset_t</span> sa_mask;               <span class="comment">/* signal mask to apply */</span>
             <span class="keyword">int</span>     sa_flags;               <span class="comment">/* see signal options below */</span>
     };
</code></pre>
<p>其中，sa_handler和sa_sigaction为信号处理函数。通常，使用sa_handler作为信号处理函数，如果在sigaction结构中使用SA_SIGINFO标志，则使用sa_sigaction作为信号处理程序为。有的系统把sa_handler和sa_sigaction用一个union表示（如mac os），所以应用只能一次使用这两个字段中的一个。sa_handler和sa_sigaction的原型如下：<br><code>void sa_handler(int)</code><br><code>void sa_sigaction (int iSignNum, siginfo_t *pSignInfo, void *pReserved);</code><br>对应的三个参数含义为：  </p>
<ul>
<li>iSignNum: 传入的信号</li>
<li>pSignInfo: 与信号相关的一些信息</li>
<li>pReserved: 保留<br>sa_mask字段为信号屏蔽字，其指出来在调用该信号捕捉程序之前，这一信号集要加到进程的信号屏蔽字中；仅当从信号捕捉函数返回时再将进程的信号屏蔽字恢复为原先值。<br>一旦对给定的信号设置一个动作，那么在调用sigaction显式地改变它之前，该设置就一直有效，这种方式与早期的不可靠信号机制不同，符合POSIX.1的要求。<br>  sa_flags指定对信号进行处理的各个选项，如SA_INTERRUPT(由信号中断的系统调用不自动重启)，SA_RESTART(信号中断的系统调用自动重启)，SA_SIGINFO(使用si_sigation处理函数，支持附加siginfo信息)<br>其中，几个常见的选项描述如下：   </li>
<li>SA_RESETHAND 处理完毕要捕捉的信号后，将自动撤消信号处理函数的注册，即必须再重新注册信号处理函数，才能继续处理接下来产生的信号。该选项不符合一般的信号处理流程，现已经被废弃。 </li>
<li>SA_NODEFER 在处理信号时，如果又发生了其它的信号，则立即进入其它信号的处理，等其它信号处理完毕后，再继续处理当前的信号，即递规地处理。如果sa_flags包含了该掩码，则结构体sigaction的sa_mask将无效！ </li>
<li>SA_RESTART 如果在发生信号时，程序正阻塞在某个系统调用，例如调用read()函数，则在处理完毕信号后，接着从阻塞的系统返回。该掩码符合普通的程序处理流程，所以一般来说，应该设置该掩码，否则信号处理完后，阻塞的系统调用将会返回失败！ </li>
<li>SA_SIGINFO 指示结构体的信号处理函数指针是哪个有效，如果sa_flags包含该掩码，则sa_sigactiion指针有效，否则是sa_handler指针有效。<h2 id="阻塞信号"><a href="#阻塞信号" class="headerlink" title="阻塞信号"></a>阻塞信号</h2></li>
</ul>
<ol>
<li>sigaction阻塞<br>函数sigaction中设置的被阻塞信号集合只是针对于要处理的信号，例如  </li>
</ol>
<pre><code class="c"><span class="keyword">struct</span> sigaction act;
sigemptyset(&amp;act.sa_mask);
sigaddset(&amp;act.sa_mask,SIGQUIT);
sigaction(SIGINT,&amp;act,<span class="literal">NULL</span>);
</code></pre>
<p>表示只有在处理信号SIGINT时，才阻塞信号SIGQUIT；  </p>
<ol>
<li>sigprocmask阻塞<br>函数sigprocmask是全程阻塞，在sigprocmask中设置了阻塞集合后，被阻塞的信号将不能再被信号处理函数捕捉，直到重新设置阻塞信号集合。其原型为：<br><code>int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);</code><br>参数how的值为如下3者之一：  </li>
</ol>
<ul>
<li>SIG_BLOCK: 将参数2的信号集合添加到进程原有的阻塞信号集合中  </li>
<li>SIG_UNBLOCK: 从进程原有的阻塞信号集合移除参数2中包含的信号  </li>
<li>SIG_SET: 重新设置进程的阻塞信号集为参数2的信号集<br>参数set为阻塞信号集<br>参数oldset是传出参数，存放进程原有的信号集。  </li>
</ul>
<h2 id="产生信号函数"><a href="#产生信号函数" class="headerlink" title="产生信号函数"></a>产生信号函数</h2><ul>
<li>kill<br><code>int kill(pid_t pid, int sig);</code><br>用于将信号发送给进程或进程组.根据pid的参数设置，kill有以下4种不同的情况：<br>1、    pid &gt; 0     将信号发送给进程ID为pid的进程<br>2、    pid == 0    将信号发送给与发送进程同一个进程组的所有进程<br>3、    pid ==  -1  将信号发送给发送进程有权限向它们发送信号的所有进程<br>4、    pid &lt; 0     将信号发送给其进程组ID等于pid绝对值，而且发送进程具有权限向其发送信号的所有进程。<br>  信号编号为0的信号为空信号。如果signo为0，则kill仍执行正常的错误检查，但不发送信号，这常被用来确定一个特点进程是否仍然存在。如果向一个并不存在的进程发送信号，则kill返回-1，errno被设置为ESRH.<br>返回值：成功返回0，否则为-1  </li>
<li>raise<br><code>int raise(int signo);</code><br>等价于  kill(getpid(), signo) 即进程向自身发送信号。  </li>
<li>alarm<br><code>unsigned int alarm(unsigned int seconds);</code><br>seconds指定经过多少秒产生SIGALRM信号;alarm函数可以设置一个定时器，在将来的某个时刻该定时器会超时，产生SIGALRM信号，如果忽略或不捕捉该信号，则其默认动作是终止调用alarm函数的进程。<br>如果seconds值为0，则取消以前的闹钟时间，其余留值作为alarm函数的返回值。  </li>
<li>sigqueue<br>sigqueue也可以发送信号，并且能传递附加的信息<br><code>int sigqueue(pid_t pid, int sig, const union sigval value);</code><br>其中value为一整型与指针类型的联合体  </li>
</ul>
<pre><code class="c"><span class="keyword">union</span> sigval {
<span class="keyword">int</span> sival_int;
<span class="keyword">void</span> *sival_ptr;
};
</code></pre>
<p>由sigqueue函数发送的信号的第3个参数value的值，可以被进程的信号处理函数的第2个参数info-&gt;si_ptr接收到。<br>附注：<br>siginfo_t结构体可以通过man sigaction查看其定义。  </p>
<p>另外，pause函数可以使调用进程挂起直至捕获到一个信号。  </p>
<h2 id="睡眠函数及定时器"><a href="#睡眠函数及定时器" class="headerlink" title="睡眠函数及定时器"></a>睡眠函数及定时器</h2><ol>
<li>sleep类函数<br>sleep及usleep   前一个是以秒为单位，后一个是以毫秒为单位<br>nanosleep  和sleep类似，但提高了纳秒级的精度<br>其中sleep是采用信号机制进行处理的<br>用到的函数有：<br><code>unsigned int alarm(unsigned int seconds);</code><br><code>int pause();</code><br>因此：不要将alarm和sleep混用，不然会出现问题。而nanosleep则没有这个问题。  </li>
<li>定时器<br>Linux下的计时器 <sys time.h=""><br>Linux为每个进程维护3个计时器，分别是真实计时器、虚拟计时器和实用计时器。  </sys></li>
</ol>
<ul>
<li>真实计时器(ITIMER_REAL)计算的是程序运行的实际时间；</li>
<li>虚拟计时器(ITIMER_VITUAL)计算的是程序运行在用户态时所消耗的时间(可认为是实际时间减掉(系统调用和程序睡眠所消耗)的时间)；</li>
<li>实用计时器(ITIMER_PROF)计算的是程序处于用户态和处于内核态所消耗的时间之和。<br>发送的信号分别为SIGALRM，SIGVTALRM，SIGPROF<br>可结合setitimer函数来实现自己的定时器，但如果需要实现多个定时器的话，需要结果list结构来实现，可以参考<a href="http://www.cnblogs.com/cobbliu/p/3627448.html" target="_blank" rel="external">用setitimer实现多个定时器</a>  <h2 id="线程与信号"><a href="#线程与信号" class="headerlink" title="线程与信号"></a>线程与信号</h2>每个线程都有自己的信号屏蔽字，但是信号的处理是进程中所有线程共享的。这意味着当某个线程改变了某个给定信号的相关处理行为时，所有线程都必须共享这个处理行为的改变，单个线程可以通过设置自己的信号屏蔽字来达到屏蔽各自不需要的信号。<br>线程中使用pthread_sigmask来设置线程的信号屏蔽字，其用法同sigprocmask，但其失败时返回错误码，不再像sigprocmask中那样设置errno并返回-1.<br>线程可以使用sigwait来等待一个或多个信号的出现。其原型如下：<br><code>int sigwait(const sigset_t * restrict set, int *restrict signop);</code><br>其中，set参数指定了线程等待的信号集；signop返回接收的信号。函数成功时返回0；错误时返回正的错误编号.<br>在sigwait返回前，sigwait将从进程中移除那些处于挂起等待的信号；如果具体实现支持信号排队，那么sigwait将会移除该信号的一个实例，其余的实例还要继续排队。<br>为了避免错误发生，线程在调用sigwait之前，必须阻塞(通过调用pthread_sigmask)那些它正在等待的信号。sig_wait会原子性地取消信号集地阻塞状态，直到接收到新的信号。在返回之前，sigwait将恢复线程的信号屏蔽字。这样不这样做，那么在线程完成对sigwait调用之前的时间窗中，信号就可以发送给该线程，从而造成sig_wait长时间阻塞不返回。<br>如果多个线程在sigwait的调用中等待同一个信号，那么在信号递送的时候，就只有一个线程可以从sigwait中返回（类似于条件变量的pthread_cond_wait）。如果这时即有sigwait调用，又有sigaction调用，那么将由操作心态决定是让sigwait返回，还是调用sigaction信号处理函数，但两者不会同时发生。<br>另外，可以通过调用pthread_kill将信号发送给指定pthread_t tid的线程，支持传递signo = 0的信号用来检查线程是否存在。</li>
</ul>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux-signal/">Linux signal</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/coding/">编程</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-database/redis/Redis" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/08/database/redis/Redis/" class="article-date">
  	<time datetime="2017-02-08T10:48:38.000Z" itemprop="datePublished">2017-02-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/08/database/redis/Redis/">Redis讲解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis数据结构及操作"><span class="toc-text">Redis数据结构及操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#string"><span class="toc-text">string</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash"><span class="toc-text">hash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list"><span class="toc-text">list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set"><span class="toc-text">set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sorted-sets"><span class="toc-text">sorted sets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis常用命令"><span class="toc-text">Redis常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#键值相关命令"><span class="toc-text">键值相关命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器相关命令"><span class="toc-text">服务器相关命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis高级实用命令"><span class="toc-text">Redis高级实用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安全性"><span class="toc-text">安全性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主从复制"><span class="toc-text">主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#主从复制特点"><span class="toc-text">主从复制特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#主从复制过程"><span class="toc-text">主从复制过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#主从复制配置"><span class="toc-text">主从复制配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务控制"><span class="toc-text">事务控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#持久化机制"><span class="toc-text">持久化机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#snapshotting方式"><span class="toc-text">snapshotting方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aof方式"><span class="toc-text">aof方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发布及订阅消息"><span class="toc-text">发布及订阅消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipeline-批量发送请求"><span class="toc-text">Pipeline 批量发送请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#虚拟内存的使用"><span class="toc-text">虚拟内存的使用</span></a></li></ol></li></ol>
</div>

         
        <h2 id="Redis数据结构及操作"><a href="#Redis数据结构及操作" class="headerlink" title="Redis数据结构及操作"></a>Redis数据结构及操作</h2><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><ul>
<li>set/setnx</li>
<li>get</li>
<li>incr/incrby</li>
<li>decr/decrbys</li>
<li>setex: set value with expire time</li>
<li>setrange: 设置指定 key 的 value 值的子字符串。</li>
<li>getrange: 获取指定 key 的 value 值的子字符串。</li>
<li>mset/msetnx: 一次设置多个key的值</li>
<li>mget</li>
<li>getset:设置key的值，并返回key的旧值</li>
<li>append: 给指定 key 的字符串值追加 value,返回新字符串值的长度。</li>
<li>strlen: 取指定 key 的 value 值的长度。</li>
</ul>
<h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><ul>
<li>hset/hsetnx</li>
<li>hmset: 同时设置 hash 的多个 field</li>
<li>hget/hmget</li>
<li>hincrby</li>
<li>hexists: 测试指定 field 是否存在</li>
<li>hlen: 返回指定 hash 的 field 数量</li>
<li>hdel: 返回指定 hash 的 field 数量</li>
<li>hkeys: 返回 hash 的所有 field</li>
<li>hvals: 返回 hash 的所有 value</li>
<li><p>hgetall: 获取某个 hash 中全部的 filed 及 value</p>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>list支持头部和尾部插入元素，也支持头尾删除元素，可以用作栈和队列  </p>
</li>
<li><p>lpush: left push, 在 key 对应 list 的头部添加字符串元素</p>
</li>
<li>lpop: lpop</li>
<li>lrang: 取某个范围的值</li>
<li>rpush: right push, 在 key 对应 list 的尾部添加字符串元素</li>
<li>linset: 在 key 对应 list 的特定位置之前或之后添加字符串元素</li>
<li>lset: 设置 list 中指定下标的元素值(下标从 0 开始)</li>
<li>lrem: 从 key 对应 list 中删除 count 个和 value 相同的元素。 count&gt;0 时,按从头到尾的顺序删除; count&lt;0 时,按从尾到头的顺序删除; count=0 时,删除全部</li>
<li>lpop: 从 list 的头部删除元素,并返回删除元素</li>
<li>rpop: 从 list 的尾部删除元素,并返回删除元素</li>
<li>rpoplpush: 从第一个 list 的尾部移除元素并添加到第二个 list 的头部,最后返回被移除的元素值,整个操 作是原子的.如果第一个 list 是空或者不存在返回 nil</li>
<li>lindex: 返回名称为 key 的 list 中 index 位置的元素</li>
<li>llen: 返回 key 对应 list 的长度</li>
</ul>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>Redis 的 set 是 string 类型的无序集合。set 元素最大可以包 (2 的 32 次方)个元素。set中的元素时唯一的  </p>
<ul>
<li>sadd: 向名称为 key 的 set 中添加元素</li>
<li>smembers: 查看set中的元素</li>
<li>srem: 删除名称为 key 的 set 中的元素 member</li>
<li>spop: 随机返回并删除名称为 key 的 set 中一个元素</li>
<li>sdiff: 返回所有给定 key 与第一个 key 的差集</li>
<li>sdiffstore: 返回所有给定 key 与第一个 key 的差集,并将结果存为另一个 key</li>
<li>sinter: 返回所有给定 key 的交集</li>
<li>sinterstore: 返回所有给定 key 的交集,并将结果存为另一个 key</li>
<li>sunion: 返回所有给定 key 的并集</li>
<li>sunionstore: 返回所有给定 key 的并集,并将结果存为另一个 key</li>
<li>smove: 从第一个 key 对应的 set 中移除 member 并添加到第二个对应 set 中</li>
<li>scard: 返回名称为 key 的 set 的元素个数</li>
<li>sismember: 测试 member 是否是名称为 key 的 set 的元素</li>
<li>srandmember: 随机返回名称为 key 的 set 的一个元素,但是不删除元素</li>
</ul>
<h3 id="sorted-sets"><a href="#sorted-sets" class="headerlink" title="sorted sets"></a>sorted sets</h3><p>sorted sets即有序的set，类似stl中的set概念。  </p>
<ul>
<li>zadd: 向名称为 key 的 zset 中添加元素 member,score 用于排序。如果该元素已经存在,则根据 score 更新该元素的顺序</li>
<li>zrange: 用于查看元素</li>
<li>zrem: 删除名称为 key 的 zset 中的元素 member</li>
<li>zincrby: 如果在名称为 key 的 zset 中已经存在元素 member,则该元素的 score 增加 increment;否则 向集合中添加该元素,其 score 的值为 increment</li>
<li>zrank: 返回名称为 key 的 zset 中 member 元素的排名(按 score 从小到大排序)即下标</li>
<li>zrevrank: 返回名称为 key 的 zset 中 member 元素的排名(按 score 从大到小排序)即下标</li>
<li>zrevrange: 返回名称为 key 的 zset(按 score 从大到小排序)中的 index 从 start 到 end 的所有元素</li>
<li>zrangebyscore: 返回集合中 score 在给定区间的元素</li>
<li>zcount: 返回集合中 score 在给定区间的数量</li>
<li>zcard: 返回集合中元素个数</li>
<li>zscore: 返回给定元素对应的 score</li>
<li>zremrangebyrank: 删除集合中排名在给定区间的元素</li>
<li>zremrangebyscore: 删除集合中 score 在给定区间的元素</li>
</ul>
<p>这些操作，只要你键入操作名后redis都会提示怎么用。如下图：  </p>
<p><img src="/img/redis_operate1.png" width="500" alt="图片名称" align="center">   </p>
<h2 id="Redis常用命令"><a href="#Redis常用命令" class="headerlink" title="Redis常用命令"></a>Redis常用命令</h2><h3 id="键值相关命令"><a href="#键值相关命令" class="headerlink" title="键值相关命令"></a>键值相关命令</h3><ul>
<li>keys: 返回满足给定 pattern 的所有 key  (使用”keys *”可以查看redis中的所有key)   </li>
<li>exists: 返回满足给定 pattern 的所有 key</li>
<li>del: 删除一个 key</li>
<li>expire: 设置一个 key 的过期时间(单位:秒)</li>
<li>select: 选择数据库</li>
<li>move: 将当前数据库中的 key 转移到其它数据库中</li>
<li>persist: 移除给定 key 的过期时间(将key设置为过期)</li>
<li>randomekey: 随机返回 key 空间的一个 key</li>
<li>rename: 重命名 key</li>
<li>type: 返回值的类型<h3 id="服务器相关命令"><a href="#服务器相关命令" class="headerlink" title="服务器相关命令"></a>服务器相关命令</h3></li>
<li>ping: 测试连接是否存活</li>
<li>echo: 在命令行打印一些内容</li>
<li>select: 选择数据库。Redis 数据库编号从 0~15,我们可以选择任意一个数据库来进行数据的存取。</li>
<li>quit: 退出连接</li>
<li>dbsize: 返回当前数据库中 key 的数目</li>
<li>info: 获取服务器的信息和统计</li>
<li>monitor: 实时转储收到的请求</li>
<li>config get: 获取服务器配置信息</li>
<li>flushdb: 删除当前选择数据库中的所有 key</li>
<li>flushall: 删除所有数据库中的所有 key</li>
</ul>
<h2 id="Redis高级实用命令"><a href="#Redis高级实用命令" class="headerlink" title="Redis高级实用命令"></a>Redis高级实用命令</h2><h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><p>在redis 配置文件中开启配置: <code>masterauth &lt;master-password&gt;</code>  </p>
<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><h4 id="主从复制特点"><a href="#主从复制特点" class="headerlink" title="主从复制特点"></a>主从复制特点</h4><ul>
<li>master 可以拥有多个 slave</li>
<li>多个 slave 可以连接同一个 master 外,还可以连接到其他 slave</li>
<li>主从复制不会阻塞 master,在同步数据时,master 可以继续处理 client 请求 </li>
<li>提高系统的伸缩性<h4 id="主从复制过程"><a href="#主从复制过程" class="headerlink" title="主从复制过程"></a>主从复制过程</h4>当配置好 slave 后,slave 与 master 建立连接,然后发送 sync 命令。无论是第一次连接还是重新连接,master 都会启动一个后台进程,将数据库快照保存到文件中,同时 master 主进 程会开始收集新的写命令并缓存。后台进程完成写文件后,master 就发送文件给 slave,slave 将文件保存到硬盘上,再加载到内存中,接着 master 就会把缓存的命令转发给 slave,后续 master 将收到的写命令发送给 slave。如果 master 同时收到多个 slave 发来的同步连接命令, master 只会启动一个进程来写数据库镜像,然后发送给所有的 slave。<h4 id="主从复制配置"><a href="#主从复制配置" class="headerlink" title="主从复制配置"></a>主从复制配置</h4></li>
</ul>
<ol>
<li>只需在slave的配置文件中添加<br><code># slaveof &lt;masterip&gt; &lt;masterport&gt;</code><br>如,<code>slaveof 192.168.1.1 6379</code></li>
<li>修改主从redis server的启动端口为不同的值，分别启动master和slave server。</li>
<li>分别连接主从 redis server进行操作，可见数据是同步的<br>tips：  </li>
</ol>
<ul>
<li>client端使用info命令，查看其输出的role值可知连接的是master还是slave。如下图：<br><img src="/img/redis_replication_info.png" width="300" alt="图片名称" align="center"><br>同时还有一个 master_link_status 用于标明主从是否异步,如果此值=up,说明同步正常;如果此值=down, 说明同步异步;<br>db0:keys=1,expires=0,avg_ttl=0, 用于说明数据库有几个 key,以及过期 key 的数量。</li>
</ul>
<h3 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h3><p>redis 对事务的支持目前还比较简单。redis 只能保证一个 client 发起的事务中的命令可以连 续的执行,而中间不会插入其他 client 的命令。 由于 redis 是单线程来处理所有 client 的请 求的所以做到这点是很容易的。一般情况下 redis 在接受到一个 client 发来的命令后会立即 处理并 返回处理结果,但是当一个 client 在一个连接中发出 multi 命令有,这个连接会进入 一个事务上下文,该连接后续的命令并不是立即执行,而是先放到一个队列中。当从此连接 受到 exec 命令后,redis 会顺序的执行队列中的所有命令。并将所有命令的运行结果打包到 一起返回给 client.然后此连接就 结束事务上下文。  </p>
<ol>
<li>简单的事务控制<br>使用multi + command1 + … + commandN + exec, 可以将多个命令一起发送到redis server，然后一起返回结果。这记为一个事务  </li>
<li>取消事务<br>通过在执行exec前调用discard可以取消事务   </li>
<li>通过watch（乐观锁）控制事务<br>在多个session同时操作数据库中的数据时，可以用watch对操作字段加锁来实现事务同步。其操作原理如下        </li>
</ol>
<table>
<thead>
<tr>
<th>session 1</th>
<th>session 2     </th>
</tr>
</thead>
<tbody>
<tr>
<td>redis 127.0.0.1:6379&gt; get age</td>
<td></td>
</tr>
<tr>
<td>“10”</td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt; watch age</td>
<td></td>
</tr>
<tr>
<td>OK</td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt; multi</td>
<td></td>
</tr>
<tr>
<td>OK</td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt;</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>redis 127.0.0.1:6379&gt; set age 30 </td>
</tr>
<tr>
<td></td>
<td>OK</td>
</tr>
<tr>
<td></td>
<td>redis 127.0.0.1:6379&gt; get age </td>
</tr>
<tr>
<td></td>
<td>“30”</td>
</tr>
<tr>
<td></td>
<td>redis 127.0.0.1:6379&gt;</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt; set age 20</td>
<td></td>
</tr>
<tr>
<td>QUEUED</td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt; exec</td>
<td></td>
</tr>
<tr>
<td>(nil)</td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt; get age</td>
<td></td>
</tr>
<tr>
<td>“30”</td>
<td></td>
</tr>
<tr>
<td>redis 127.0.0.1:6379&gt;</td>
<td></td>
</tr>
</tbody>
</table>
<p>从以上实例可以看到在<br>第一步,Session 1 还没有来得及对 age 的值进行修改<br>第二步,Session 2 已经将 age 的值设为 30<br>第三步,Session 1 希望将 age 的值设为 20,但结果一执行返回是 nil,说明执行失败,之后 我们再取一下 age 的值是 30,这是由于 Session 1 中对 age 加了乐观锁导致的。  </p>
<p><strong>redis 的事务实现是如此简单,当然会存在一些问题</strong><br>第一个问题是 redis 只能保证事务的每 个命令连续执行,但是如果事务中的一个命令失败了,并不回滚其他命令,比如使用的命令类型不匹配。<br>如： </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">age</span>   </div><div class="line">"30"  <span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">name</span>"<span class="selector-tag">HongWan</span>"<span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">multi</span><span class="selector-tag">OK</span><span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">incr</span> <span class="selector-tag">age</span><span class="selector-tag">QUEUED</span><span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">incr</span> <span class="selector-tag">name</span><span class="selector-tag">QUEUED</span><span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">exec</span>1) (<span class="selector-tag">integer</span>) 312) (<span class="selector-tag">error</span>) <span class="selector-tag">ERR</span> <span class="selector-tag">value</span> <span class="selector-tag">is</span> <span class="selector-tag">not</span> <span class="selector-tag">an</span> <span class="selector-tag">integer</span> <span class="selector-tag">or</span> <span class="selector-tag">out</span> <span class="selector-tag">of</span> <span class="selector-tag">range</span>   </div><div class="line"><span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">age</span>"31"<span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">name</span> "<span class="selector-tag">HongWan</span>"<span class="selector-tag">redis</span> 127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt;</div></pre></td></tr></table></figure>
<p>从以上操作我们可以看出由于name是非数字，不支持incr操作，导致事务失败了，但age却成功加1。  <strong>不过我现在用的redis 3.2.7版本已经没有这个问题。</strong></p>
<h3 id="持久化机制"><a href="#持久化机制" class="headerlink" title="持久化机制"></a>持久化机制</h3><p>redis 是一个支持持久化的内存数据库,也就是说 redis 需要经常将内存中的数据同步到磁盘 来保证持久化。redis 支持两种持久化方式,一种是 Snapshotting(快照)也是默认方式,另 一种是 Append-only file(缩写 aof)的方式。下面分别介绍:</p>
<h4 id="snapshotting方式"><a href="#snapshotting方式" class="headerlink" title="snapshotting方式"></a>snapshotting方式</h4><p>这是默认的持久化方式。这种方式就是将内存中数据以snapshot方式写入到二进制文件中，默认的文件名为dump.rdb。可以通过配置自动做快照持久化的方式。redis可以配置在n秒内如果超过m个key被修改就自动做snapshot。其默认的配置如下：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">################################ SNAPSHOTTING  ################################</div><div class="line">save <span class="number">900</span> <span class="number">1</span>   #<span class="number">900</span> 秒内如果超过 <span class="number">1</span> 个 <span class="type">key</span> 被修改,则发起快照保存</div><div class="line">save <span class="number">300</span> <span class="number">10</span>  #<span class="number">300</span> 秒内容如超过 <span class="number">10</span> 个 <span class="type">key</span> 被修改,则发起快照保存</div><div class="line">save <span class="number">60</span> <span class="number">10000</span></div></pre></td></tr></table></figure>
<p>snapshot过程如下：  </p>
<ol>
<li>redis调用fork，创建子进程</li>
<li>父进程继续处理client请求，子进程负责将内存内容写入到临时文件。由写时拷贝原理，父子进程共享相同的物理页面。当父进程需要写操作时会重新创建副本，故子进程地址空间内的数据是fork时刻整个数据库的一个快照。</li>
<li>当子进程将快照写入临时文件完毕后，用临时文件替换之前的快照文件，然后子进程退出。<br>p.s: redis也支持使用save或bgsave命令通知redis做一次快照操作。不过save操作是在主进程中保存快照的，这是会阻塞所有的client请求，不推荐使用。<br>redis的快照文件为dump.rdb</li>
</ol>
<h3 id="aof方式"><a href="#aof方式" class="headerlink" title="aof方式"></a>aof方式</h3><p>由于快照是在一定间隔时间做一次的，因此如果redis意外down掉的话，就会丢失最后一次快照后的所有修改。如果要求应用不能丢失任何修改的话，可以采用aof持久化方式。<br>aof(append-only file)比snapshot具有更好的持久化性，当使用aof方式时，redis会将收到的命令通过write函数追加到文件中(默认是appendonly.aof)。当redis重启时会通过重新执行文件中保存的写命令来重建整个数据库的内容。<br>由于os会在内核中缓存write做的修改，所以aof文件可能不是立即写到磁盘上，也存在丢失部分修改的情况。不过我们可以通过配置文件告诉redis通过fsync函数强制写入磁盘的时机。aof方式可以通过配置<code>appendonly yes</code>启用，其有进行sync的时间有如下三种方式：  </p>
<ul>
<li>appendfsync always    //收到命令立即写入磁盘，最慢，但是持久性最好</li>
<li>appendfsync everysec  //默认方式，每秒钟写入磁盘一次，是持久性和性能的折中</li>
<li>appendfsync no        //由操作系统选择，性能最优，但持久性没保证</li>
</ul>
<p>aof方式的一个问题是持久化文件会越变越大(因为其为保存了每一条命令，如执行<code>incr var</code>100次，则要保存100条，但其实恢复状态只需set var var 100即可[假设var初值为0])。为了压缩aof的持久化文件。redis提 供了 bgrewriteaof 命令。收到此命令 redis 将使用与快照类似的方式将内存中的数据以命令 的方式保存到临时文件中,最后替换原来的文件。具体过程如下：  </p>
<ol>
<li>redis 调用 fork ,现在有父子两个进程 </li>
<li>子进程根据内存中的数据库快照,往临时文件中写入重建数据库状态的命令</li>
<li>父进程继续处理 client 请求,除了把写命令写入到原来的 aof 文件中。同时把收到的写命 令缓存起来。这样就能保证如果子进程重写失败的话并不会出问题。 </li>
<li>当子进程把快照内容写入已命令方式写到临时文件中后,子进程发信号通知父进程。然 后父进程把缓存的写命令也写入到临时文件。</li>
<li>现在父进程可以使用临时文件替换老的 aof 文件,并重命名,后面收到的写命令也开始 往新的 aof 文件中追加。</li>
</ol>
<h3 id="发布及订阅消息"><a href="#发布及订阅消息" class="headerlink" title="发布及订阅消息"></a>发布及订阅消息</h3><p>redis 作为一个 pub/sub 的 server,在订阅者 和发布者之间起到了消息路由的功能。订阅者可以通过 subscribe 和 psubscribe 命令向 redis server 订阅自己感兴趣的消息类型,redis 将消息类型称为通道(channel)。当发布者通过 publish命令向redis server发送特定类型的消息时, 订阅该消息类型的全部client都会收到此消息。这里消息的传递是多对多的。一个 client 可以订阅多个 channel,也可以向多个 channel 发送消息。redis提供相关的命令如下：</p>
<ul>
<li>SUBSCRIBE channel [channel …]: 用于订阅某个频道或者多个频道 </li>
<li>PUBLISH channel message: 用于发布频道信息</li>
<li>PSUBSCRIBE pattern [pattern …]: 批量订阅满足某一pattern的频道，如tv*，表示以tv开头的频道</li>
</ul>
<h3 id="Pipeline-批量发送请求"><a href="#Pipeline-批量发送请求" class="headerlink" title="Pipeline 批量发送请求"></a>Pipeline 批量发送请求</h3><p>由于redis server处理命令的速度很快，如果客户端命令多的话，可以一起打包发送给server，从而减少大部分的网络延迟，达到提高性能的目的。我们可以利用 pipeline 的方式 从 client 打包多条命令一起发出,不需要等待单条命令的响应返回,而 redis 服务端会处理 完多条命令后会将多条命令的处理结果打包到一起返回给客户端。同时，打包的命令越多,缓存消耗内存也越多。所以并不是打包的命令 越多越好。具体多少合适需要根据具体情况测试。  </p>
<p>java代码：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//usepipeline</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">usePipeline</span><span class="params">()</span> </span>&#123;<span class="keyword">try</span> &#123;ConnectionSpec spec = DefaultConnectionSpec.newSpec(<span class="string">"192.168.115.170"</span>, <span class="number">6379</span>, <span class="number">0</span>, <span class="keyword">null</span>); JRedis jredis = <span class="keyword">new</span> JRedisPipelineService(spec);<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123; jredis.incr(<span class="string">"test2"</span>);&#125;jredis.quit();&#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;&#125;</div></pre></td></tr></table></figure>
<pre><code class="java"><span class="comment">//withoutPipleline</span>
<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">withoutPipeline</span><span class="params">()</span> </span>{
<span class="keyword">try</span> {
JRedis jredis = <span class="keyword">new</span> JRedisClient(<span class="string">"192.168.115.170"</span>, <span class="number">6379</span>);
<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) { jredis.incr(<span class="string">"test2"</span>);}
jredis.quit();
} <span class="keyword">catch</span> (Exception e) {
}
}
</code></pre>
<h3 id="虚拟内存的使用"><a href="#虚拟内存的使用" class="headerlink" title="虚拟内存的使用"></a>虚拟内存的使用</h3><p>redis实现了自己的虚拟内存管理。redis 没有使用操作系统提供的虚拟内存机制而是自己在实现了自己的虚拟内存机制,主要的理由有两点:</p>
<ol>
<li>操作系统的虚拟内存是已 4k 页面为最小单位进行交换的。而 redis 的大多数对象都远小 于 4k,所以一个操作系统页面上可能有多个 redis 对象。另外 redis 的集合对象类型如 list,set 可能存在与多个操作系统页面上。最终可能造成只有 10%key 被经常访问,但是所有操作系 统页面都会被操作系统认为是活跃的,这样只有内存真正耗尽时操作系统才会交换页面。</li>
<li>相比于操作系统的交换方式,redis 可以将被交换到磁盘的对象进行压缩,保存到磁盘的对 象可以去除指针和对象元数据信息,一般压缩后的对象会比内存中的对象小 10 倍,这样 redis 的虚拟内存会比操作系统虚拟内存能少做很多 io 操作</li>
</ol>
<p><strong><em>参考资料</em></strong>：《redis实战》</p>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/coding/">编程</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-database/mysql/Mysql基本命令" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/08/database/mysql/Mysql基本命令/" class="article-date">
  	<time datetime="2017-02-08T10:48:31.000Z" itemprop="datePublished">2017-02-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/08/database/mysql/Mysql基本命令/">Mysql基本命令</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql入门"><span class="toc-text">mysql入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动与停止mysql服务器"><span class="toc-text">启动与停止mysql服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接mysql服务器"><span class="toc-text">连接mysql服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#命令"><span class="toc-text">命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#相关文档"><span class="toc-text">相关文档</span></a></li></ol></li></ol>
</div>

         
        <p><a href="http://doc.mysql.cn/mysql5/refman-5.1-zh.html-chapter/" target="_blank" rel="external">sql 中文html手册</a><br><a href="http://club.topsage.com/thread-488779-1-1.html" target="_blank" rel="external">mysql文档中心</a><br><a href="https://www.gitbook.com/book/strongyoung/mysql-reference-manual/details" target="_blank" rel="external">MySQL参考手册</a></p>
<h2 id="mysql入门"><a href="#mysql入门" class="headerlink" title="mysql入门"></a>mysql入门</h2><p>命令是接触mysql的第一扇窗户，下面介绍mac下mysql的使用  </p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><code>brew install mysql</code><br>安装时间可能比较久，需要耐心等待</p>
<h3 id="启动与停止mysql服务器"><a href="#启动与停止mysql服务器" class="headerlink" title="启动与停止mysql服务器"></a>启动与停止mysql服务器</h3><ol>
<li>启动mysql服务：support-files/mysql.server start</li>
<li>停止mysql服务: support-files/mysql.server stop</li>
<li>查询mysql服务器状态：support-files/mysql.server status<br>启动和停止成功后，terminal上会有对应的提示信息</li>
</ol>
<h3 id="连接mysql服务器"><a href="#连接mysql服务器" class="headerlink" title="连接mysql服务器"></a>连接mysql服务器</h3><ol>
<li>连接到mysql服务器<br>要连接到服务器，需要使用登陆名和密码(对于密码为空的情况，则只需要用户名)；如果mysql服务器运行在与客户端不同的机器上，还需要清楚mysql服务器的主机名，连接方法如下：<br><code>shell&gt; mysql [-h hostname] -u user [-p]</code><br>在需要密码的情况下会弹出如下提示，让你输入密码：<br>Enter password: </li>
<li>断开连接<br>可以使用quit或exit命命进行登出  </li>
</ol>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><ol>
<li>选择与创建数据库<br>show databases  查看服务器当前存在的数据库<br>use databasename  选择数据库<br>create databse databasename  创建数据库  </li>
<li>设置登录密码<br>alter user ‘root’@’localhost’ identified by ‘newpassword’ (5.7.6及以后的版本)<br>set password for ‘root’@’localhost’ = password(‘newpassword’)<br>其中，newpassword是我们将要设置的新密码  </li>
<li>创建表<br>create table tablename (columnname type, …);<br>show tables 查看表<br>describe pet 查看表信息（字段，类型等）</li>
<li>查询，更新，删除<br>同sql语法  </li>
</ol>
<h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><p>详细说明可见文档：<br><a href="/document/mysql_operate.pdf">mysql command</a><br><a href="/document/mysql-reference-manual.pdf">mysql-reference-manual</a></p>
<p>建议：</p>
<p>1.坚持阅读官方手册，看MySQL书籍作用不会特别大；（挑选跟工作相关的内容优先阅读，例如InnoDB存储引擎，MySQL复制，查询优化）</p>
<p>2.阅读官方手册，同时对阅读的内容做对应的测试；</p>
<p>3.结合你现在的工作内容，多实战即可；</p>
<p>4.外部的BLOG ，也包过我的 <a href="http://mysqlops.com" target="_blank" rel="external">http://mysqlops.com</a> 只是作为参考即可，更多要培养自己的分析思考的模式；</p>
<p>备注：</p>
<p>国内人写的MySQL书籍都不要作为重点，包过我可能2014年出版一本关于MySQL的书籍，推荐大家只作为辅助的，可以上厕所的时候看看，坚持官方手册+测试+实战+思考总结为主的模式。</p>
<p>作者：mysqlops<br>链接：<a href="https://www.zhihu.com/question/21760988/answer/19357455" target="_blank" rel="external">https://www.zhihu.com/question/21760988/answer/19357455</a><br>来源：知乎<br>著作权归作者所有，转载请联系作者获得授权。</p>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/coding/">编程</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-readedBook2016" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/05/readedBook2016/" class="article-date">
  	<time datetime="2017-02-05T15:14:42.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/05/readedBook2016/">2016年阅读的书籍列表</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Done"><span class="toc-text">Done</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reading"><span class="toc-text">Reading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#To-do"><span class="toc-text">To do</span></a></li></ol>
</div>

         
        <h2 id="Done"><a href="#Done" class="headerlink" title="Done"></a>Done</h2><ul>
<li>unix编程艺术</li>
<li>代码大全(Code Completed) </li>
<li>人月神话</li>
<li>代码整洁之道</li>
<li>tomcat原理</li>
<li>progit</li>
<li>java编程思想</li>
</ul>
<h2 id="Reading"><a href="#Reading" class="headerlink" title="Reading"></a>Reading</h2><ul>
<li>计算机程序的构造与解释</li>
<li>java机器人</li>
<li>openssl编程</li>
<li>企业应用架构模式</li>
</ul>
<h2 id="To-do"><a href="#To-do" class="headerlink" title="To do"></a>To do</h2><ul>
<li>《Tomcat与Java Web开发技术详解(第2版)》.(孙卫琴).[PDF].&amp;ckook</li>
<li>Linux多线程服务端编程</li>
<li>编程珠玑</li>
<li>TCP/IP详解</li>
<li>redis实战</li>
<li>搜索引擎原理技术与系统</li>
<li>Java Concurrency in Pratice</li>
<li>现代操作系统（可以看看）</li>
</ul>
<p>语法分析器lex及语句输入器yacc lex与yacc</p>
<p>进程通信及线程同步的方法<br>线程同步：</p>
<ul>
<li>互斥量pthread_mutex_t</li>
<li>条件变量pthread_cond_t</li>
<li>信号量sem_t</li>
<li>全局变量</li>
<li>读写锁pthread_rwlock_t </li>
</ul>
<p>进程通信：</p>
<ul>
<li>socket</li>
<li>pipe</li>
<li>文件</li>
<li>锁机制(文件锁，共享内存＋互斥锁)</li>
<li>共享内存</li>
<li>信号</li>
<li>信号量(共享内存)</li>
<li>消息队列msg_queue</li>
</ul>
<p>今年提高的部分：<br>python脚本  达到熟练使用<br>Linux 多进程多线程编程   积累经验<br>存储处理等大数据通信存储  看书，代码<br>熟悉NoSQL、key-value存储原理使用、列存储<br>安全漏洞发现及监测<br>Reactor proactor spring模式</p>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/essay/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-OperateSystem/centos" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/28/OperateSystem/centos/" class="article-date">
  	<time datetime="2016-12-28T15:21:53.000Z" itemprop="datePublished">2016-12-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/28/OperateSystem/centos/">centos</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装中文"><span class="toc-text">安装中文</span></a></li></ol>
</div>

         
        <h2 id="安装中文"><a href="#安装中文" class="headerlink" title="安装中文"></a>安装中文</h2><p>yum install “@Chinese Support”</p>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos/">centos</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/OS/">OS</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-c_c++/epoll" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/28/c_c++/epoll/" class="article-date">
  	<time datetime="2016-12-28T14:36:35.000Z" itemprop="datePublished">2016-12-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/28/c_c++/epoll/">epoll讲解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#epoll接口函数"><span class="toc-text">epoll接口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建epoll实例"><span class="toc-text">创建epoll实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理epoll事件"><span class="toc-text">管理epoll事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#等待epoll事件"><span class="toc-text">等待epoll事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#epoll实例"><span class="toc-text">epoll实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mac下的epoll"><span class="toc-text">mac下的epoll</span></a></li></ol>
</div>

         
        <h2 id="epoll接口函数"><a href="#epoll接口函数" class="headerlink" title="epoll接口函数"></a>epoll接口函数</h2><p>头文件: #include&lt;sys/epoll.h&gt;<br>可以通过man epoll查看对应的帮助信息<br>最大描述符限制：/proc/sys/fs/epoll/max_user_watches  </p>
<h3 id="创建epoll实例"><a href="#创建epoll实例" class="headerlink" title="创建epoll实例"></a><strong>创建epoll实例</strong></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_create</span><span class="params">(<span class="keyword">int</span> size)</span></span>; </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_create1</span><span class="params">(<span class="keyword">int</span> flag)</span></span>;</div></pre></td></tr></table></figure>
<p>epoll_create中，size只是给内核的一个维数提示，并不是队列中的最大数，Now days， size is ignored since Linux 2.6.8<br>epoll_create1中flag取值如下：    </p>
<ul>
<li>0:epoll_create1 == epoll_create (size argument is dropped)  </li>
<li>EPOLL_CLOEXEC:含义同open函数的O_CLOEXEC选项；当执行execve创建新进程时，打开的描述符自动关闭<br>p.s: 当使用完毕时，需要调用close关闭epoll实例句柄<h3 id="管理epoll事件"><a href="#管理epoll事件" class="headerlink" title="管理epoll事件"></a><strong>管理epoll事件</strong></h3></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_ctl</span> <span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, <span class="keyword">struct</span> epoll_event *event)</span></span>;</div></pre></td></tr></table></figure>
<p>参数说明：  </p>
<ul>
<li>epfd: epoll_create返回的epoll实例    </li>
<li>op: 对应的操作  </li>
<li>fd: 监听的fd  </li>
<li>event: 监听的事件<br>其中op取值如下：    </li>
<li>EPOLL_CTL_ADD:添加监听的事件  </li>
<li>EPOLL_CTL_DEL:删除监听的事件  </li>
<li>EPOLL_CTL_MOD:修改监听的事件<br>struct epoll_event定义如下:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> epoll_data</div><div class="line">&#123;</div><div class="line">  <span class="keyword">void</span> *ptr;</div><div class="line">  <span class="keyword">int</span> fd;</div><div class="line">  <span class="keyword">uint32_t</span> u32;</div><div class="line">  <span class="keyword">uint64_t</span> u64;</div><div class="line">&#125; <span class="keyword">epoll_data_t</span>;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> epoll_event</div><div class="line">&#123;</div><div class="line">  <span class="keyword">uint32_t</span> events;	<span class="comment">/* Epoll events */</span></div><div class="line">  <span class="keyword">epoll_data_t</span> data;	<span class="comment">/* User data variable */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>其中events可以包含以下事件类型：    </p>
<ul>
<li>EPOLLIN: 描述符可读  </li>
<li>EPOLLOUT: 描述符可写  </li>
<li>EPOLLRDHUP(since Linux 2.6.17): 流套接字对端关闭连接或者关闭写端  </li>
<li>EPOLLPRI: 紧急数据可读  </li>
<li>EPOLLERR: 描述符发生错误，该事件由内核一直监听  </li>
<li>EPOLLHUP: 文件秒杀符被中断，该事件由内核一直监听  </li>
<li>EPOLLET: 开启边缘触发，默认是水平触发</li>
<li>EPOLLONESHOT: 一个事件发生并读取之后，fd自动不再监控；若要重新监控需要使用EPOLL_CTL_MOD重新设置<br>返回值: 成功返回0，失败返回－1并设置errno  <h3 id="等待epoll事件"><a href="#等待epoll事件" class="headerlink" title="等待epoll事件"></a><strong>等待epoll事件</strong></h3></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">struct</span> epoll_event *events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</div></pre></td></tr></table></figure>
<p>参数说明：  </p>
<ul>
<li>epfd: epoll_create返回的epoll实例    </li>
<li>events: 存储epoll_event的数组地址  </li>
<li>maxevents: 最大事件的数量，需&gt;0  </li>
<li>timeout: 等待的最长时间<br>返回值:<br>成功时返回就绪的监听文件描述符数；当超出timeout指定的时间后如果无就绪的文件描述符，返回0；发生错误时返回－1并设置errno<br>另外，Linux kernel 2.6.19 引入了epoll_pwait，可以在等待时设置信号掩码，其使用方式类似pselect  </li>
</ul>
<p><em>some problems</em>:   </p>
<ol>
<li>epoll 怎么判断是connect请求还是有数据可读？<br>ans: 判断events[i].data.fd == listen_fd      </li>
<li>read 返回值说明：  </li>
</ol>
<ul>
<li>return -1 and errno == EAGAIN: 数据已经读完，没有可读数据  </li>
<li>return 0: end of file，对端关闭连接  </li>
</ul>
<p><strong><em>关于水平触发(Level-Triggered)和边缘触发(Edge-Triggered)</em></strong><br>当缓冲区有数据可读时，ET会触发一次事件，之后就不会再触发；而LT只要我们没有读完缓冲区的数据，事件就会一直触发。<br>推荐使用的epoll ET方式如下：</p>
<ol>
<li>设置fd为非阻塞  </li>
<li>当调用read或write读写时，在其返回-1，且errno == EAGAIN 后再调用epoll_wait等待<br>tips:<br>ET模式只能用于设置了O_NONBLOCK的fd，而LT则同时支持同步及异步。如果将ET模式应用与阻塞情况，将出现如下问题：<br>当对端send 2 byte数据，而服务端只读取了1 byte后再去调用epoll_wait，这时将不产生读事件。直到对端又有数据发送过来，epoll_wait才会再次返回<br>补充：<br>Q：当又有事件产生时会怎么样，原来的数据还在吗？<br>A：原来的数据还在socket缓冲区  <h2 id="epoll实例"><a href="#epoll实例" class="headerlink" title="epoll实例"></a>epoll实例</h2>epoll使用参考：  </li>
</ol>
<ul>
<li>服务端代码：<a href="https://banu.com/blog/2/how-to-use-epoll-a-complete-example-in-c/" target="_blank" rel="external">How to use epoll? A complete example in C</a>, it’s a well write paper.  </li>
<li>客户端代码： </li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">create_and_connect</span><span class="params">(<span class="keyword">char</span> * port)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> == port)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">struct</span> addrinfo hints;</div><div class="line">    <span class="built_in">memset</span>(&amp;hints, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> addrinfo));</div><div class="line">    hints.ai_family = AF_UNSPEC;</div><div class="line">    hints.ai_socktype = SOCK_STREAM;</div><div class="line">    hints.ai_flags = AI_PASSIVE;</div><div class="line"></div><div class="line">    <span class="keyword">struct</span> addrinfo *result;</div><div class="line">    <span class="keyword">int</span> ret = getaddrinfo(<span class="literal">NULL</span>, port, &amp;hints, &amp;result);</div><div class="line">    <span class="keyword">if</span>(ret != <span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"getaddrinfo error: %s\n"</span>, gai_strerror(ret));</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">struct</span> addrinfo *rp;</div><div class="line">    <span class="keyword">int</span> cfd;</div><div class="line">    <span class="keyword">for</span>(rp = result; rp != <span class="literal">NULL</span>; rp = rp-&gt;ai_next)</div><div class="line">    &#123;</div><div class="line">        cfd = socket(rp-&gt;ai_family, rp-&gt;ai_socktype, rp-&gt;ai_protocol);</div><div class="line">        <span class="keyword">if</span>(<span class="number">-1</span> == cfd)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">    </div><div class="line">        <span class="comment">//client connect</span></div><div class="line">        ret = connect(cfd, rp-&gt;ai_addr, rp-&gt;ai_addrlen);</div><div class="line">        <span class="keyword">if</span>(<span class="number">0</span> == ret)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        close(cfd);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> == rp)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"connect to port failed!\n"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    freeaddrinfo(result);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> cfd;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Usage: %s [port]\n"</span>, argv[<span class="number">0</span>]);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//clinet send something</span></div><div class="line">    <span class="keyword">int</span> cfd = create_and_connect(argv[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">if</span>(<span class="number">-1</span> == cfd)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"create_and_connect failed\n"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;    </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> *pData = <span class="string">"Client hello!"</span>;</div><div class="line">    <span class="keyword">int</span> dataLen = <span class="built_in">strlen</span>(pData);</div><div class="line">    send(cfd, pData, dataLen, <span class="number">0</span>);</div><div class="line">    sleep(<span class="number">1</span>);</div><div class="line">    </div><div class="line">    send(cfd, pData, dataLen, <span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="mac下的epoll"><a href="#mac下的epoll" class="headerlink" title="mac下的epoll"></a>mac下的epoll</h2><p>mac os不支持epoll，其使用kqueue实现（类似epoll），头文件 sys/event.h<br><em>link</em>：<a href="https://zhuanlan.zhihu.com/p/21375144" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/21375144</a></p>
<p>参考博客：<a href="http://blog.lucode.net/linux/epoll-tutorial.html" target="_blank" rel="external">Linux epoll 详解</a></p>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/epoll/">epoll</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/TCP-IP/">TCP/IP</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-tools/vim/myVimrc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/27/tools/vim/myVimrc/" class="article-date">
  	<time datetime="2016-12-27T14:09:59.000Z" itemprop="datePublished">2016-12-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/27/tools/vim/myVimrc/">我的vimrc快捷操作</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#leader键"><span class="toc-text">leader键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动保存及加载工程设置"><span class="toc-text">自动保存及加载工程设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#保存viminfo及session"><span class="toc-text">保存viminfo及session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#恢复viminfo及session"><span class="toc-text">恢复viminfo及session</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缩进可视化"><span class="toc-text">缩进可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cpp和h文件间切换"><span class="toc-text">cpp和h文件间切换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示tag窗口"><span class="toc-text">显示tag窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cscope支持"><span class="toc-text">cscope支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示当前目录文件列表"><span class="toc-text">显示当前目录文件列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示及隐藏minibufexplorer窗口"><span class="toc-text">显示及隐藏minibufexplorer窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在整个目录下查找匹配的关键字"><span class="toc-text">在整个目录下查找匹配的关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lookupfile查找"><span class="toc-text">lookupfile查找</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#youcompleteme快捷键"><span class="toc-text">youcompleteme快捷键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#窗口移动操作"><span class="toc-text">窗口移动操作</span></a></li></ol>
</div>

         
        <h2 id="leader键"><a href="#leader键" class="headerlink" title="leader键"></a><strong>leader键</strong></h2><p>mapleader = “;”  </p>
<h2 id="自动保存及加载工程设置"><a href="#自动保存及加载工程设置" class="headerlink" title="自动保存及加载工程设置"></a><strong>自动保存及加载工程设置</strong></h2><p>在工程目录下创建workspace.vim配置文件，其中可以设置项目path等信息  </p>
<h3 id="保存viminfo及session"><a href="#保存viminfo及session" class="headerlink" title="保存viminfo及session"></a><em>保存viminfo及session</em></h3><p><leader>ss   (save session)  </leader></p>
<h3 id="恢复viminfo及session"><a href="#恢复viminfo及session" class="headerlink" title="恢复viminfo及session"></a><em>恢复viminfo及session</em></h3><p><leader>rs   (read session)  </leader></p>
<h2 id="缩进可视化"><a href="#缩进可视化" class="headerlink" title="缩进可视化"></a><strong>缩进可视化</strong></h2><p>vimrc中配置自动打开，可以使用<leader>i进行开关  </leader></p>
<h2 id="cpp和h文件间切换"><a href="#cpp和h文件间切换" class="headerlink" title="cpp和h文件间切换"></a><strong>cpp和h文件间切换</strong></h2><p><leader>sw    (switch)</leader></p>
<h2 id="显示tag窗口"><a href="#显示tag窗口" class="headerlink" title="显示tag窗口"></a><strong>显示tag窗口</strong></h2><p><f10>  or  <leader>ilt (identifier list by tag)  </leader></f10></p>
<h2 id="cscope支持"><a href="#cscope支持" class="headerlink" title="cscope支持"></a><strong>cscope支持</strong></h2><p>自动导入工程目录下的cscope.out文件<br>set cscopequickfix=s-,c-,d-,i-,t-,e-  使用quickfix窗口显示搜索结果<br>浏览结束后按 <c-t> 或者 <c-o> 可以回到跳转前的位置。<br>快捷操作：<br>如果每次查找都要输入一长串命令的话还真是件讨人厌的事情, Cscope的帮助<br>手册中推荐了一些快捷键的用法, 下面是其中一组, 也是我用的, 将下面的内容添<br>加到~/.vimrc中, 并重启vim: </c-o></c-t></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span>s :<span class="keyword">cs</span> <span class="keyword">find</span> s <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cword&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span>g :<span class="keyword">cs</span> <span class="keyword">find</span> g <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cword&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span><span class="keyword">c</span> :<span class="keyword">cs</span> <span class="keyword">find</span> <span class="keyword">c</span> <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cword&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span>t :<span class="keyword">cs</span> <span class="keyword">find</span> t <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cword&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span><span class="keyword">e</span> :<span class="keyword">cs</span> <span class="keyword">find</span> <span class="keyword">e</span> <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cword&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span><span class="keyword">f</span> :<span class="keyword">cs</span> <span class="keyword">find</span> <span class="keyword">f</span> <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cfile&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span>i :<span class="keyword">cs</span> <span class="keyword">find</span> i ^<span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cfile&gt;"</span>)<span class="symbol">&lt;CR&gt;</span>$<span class="symbol">&lt;CR&gt;</span>  </div><div class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-_&gt;</span>d :<span class="keyword">cs</span> <span class="keyword">find</span> d <span class="symbol">&lt;C-R&gt;</span>=<span class="built_in">expand</span>(<span class="string">"&lt;cword&gt;"</span>)<span class="symbol">&lt;CR&gt;</span><span class="symbol">&lt;CR&gt;</span></div></pre></td></tr></table></figure>
<p>  当光标停在某个你要查找的词上时, 按下<c-_>g, 就是查找该对象的定义, 其他的同理. 按这种组合键有一点技巧,按了<c-_>后要马上按下一个键,否则屏幕一闪就回到<br>nomal状态了<br>    <c-_>g的按法是先按”Ctrl+Shift+-“, 然后很快再按”s”</c-_></c-_></c-_></p>
<h2 id="显示当前目录文件列表"><a href="#显示当前目录文件列表" class="headerlink" title="显示当前目录文件列表"></a><strong>显示当前目录文件列表</strong></h2><p><f2>  (用NERDTree插件显示)</f2></p>
<h2 id="显示及隐藏minibufexplorer窗口"><a href="#显示及隐藏minibufexplorer窗口" class="headerlink" title="显示及隐藏minibufexplorer窗口"></a><strong>显示及隐藏minibufexplorer窗口</strong></h2><p><leader>bl  (buffer explorer)<br>buffer间切换 —— ctrl+Tab(向后)，ctrl+shift+Tab(向前)</leader></p>
<h2 id="在整个目录下查找匹配的关键字"><a href="#在整个目录下查找匹配的关键字" class="headerlink" title="在整个目录下查找匹配的关键字"></a><strong>在整个目录下查找匹配的关键字</strong></h2><p><leader>sp (search project)  ［CtrlSF插件］<br>感觉这个插件和cscope功能有重叠的部分</leader></p>
<h2 id="lookupfile查找"><a href="#lookupfile查找" class="headerlink" title="lookupfile查找"></a><strong>lookupfile查找</strong></h2><ul>
<li><leader>lt  (LUTags)  </leader></li>
<li><leader>lb  (LUBufs)  </leader></li>
<li><leader>lw  (LUWalk)<br>分别对应查找tag，buffer及目录文件<h2 id="youcompleteme快捷键"><a href="#youcompleteme快捷键" class="headerlink" title="youcompleteme快捷键"></a><strong>youcompleteme快捷键</strong></h2></leader></li>
<li><leader>jc  (jump to declaration)  </leader></li>
<li><leader>jd  (jump to definition)  </leader></li>
<li><leader>;    (智能补全)<h2 id="窗口移动操作"><a href="#窗口移动操作" class="headerlink" title="窗口移动操作"></a><strong>窗口移动操作</strong></h2>ctrl+[h|j|k|l]  (分别对应于左上下右，与方向键一致)</leader></li>
</ul>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/">vim</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/vim/">vim</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-tools/vim/vim-configuration" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/22/tools/vim/vim-configuration/" class="article-date">
  	<time datetime="2016-12-22T15:40:11.000Z" itemprop="datePublished">2016-12-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/22/tools/vim/vim-configuration/">vim_configuration</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#保存及应用工程配置"><span class="toc-text">保存及应用工程配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用ctags"><span class="toc-text">使用ctags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓冲区及文件、tag查找"><span class="toc-text">缓冲区及文件、tag查找</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cscope使用"><span class="toc-text">cscope使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动刷新工程中的tags"><span class="toc-text">自动刷新工程中的tags</span></a></li></ol>
</div>

         
        <h2 id="保存及应用工程配置"><a href="#保存及应用工程配置" class="headerlink" title="保存及应用工程配置"></a>保存及应用工程配置</h2><ol>
<li>设置vim搜索路径<br>如set path＝.,/usr/include,/usr/local/include，当使用find, gf, ctrl+W f(水平分割窗口打开)命令时vim会去path变量设置的目录下搜索.使用时可以把需要做的设置写到workspace.vim文件中，然后在打开工程的时候加载</li>
<li>保存vim session及viminfo<br>使用会话(session)和viminfo，可以把你编辑环境保存下来，然后在你下次启动vim后，可以再恢复回这个环境。<br><strong><em> session </em></strong><br>会话(session)中保存了所有窗口的视图，外加全局设置。可以使用‘set sessionoptions’选项设定。缺省的‘sessionoptions’选项包括: “blank,buffers,curdir,folds,help,options,tabpages,winsize”<br><em>command</em>: 使用mksession [file]命令来保存session，使用source [file]命令来导入保存的session<br><strong><em> viminfo </em></strong><br>viminfo中保存了命令行历史(history)、搜索历史(search)、输入行历史、非空的寄存器内容(register)、文件的位置标记(mark)、缓冲区列表、全局变量等信息。<br><em>command</em>: 使用wviminfo [file]命令保存viminfo，使用rviminfo命令载入保存的viminfo  </li>
<li>自动导入工程配置<br>每次退出vim时都要手动保存viminfo及session文件，启动时再进行导入，岂不是很麻烦，如果能支持自动导入的话就very nice了。没问题，我们可以通过修改vimrc文件来实现这个目的.相关vimrc配置如下(可结合自身情况更改)：</li>
</ol>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">" 设置自动加载当前目录的工程设置</span></div><div class="line"><span class="keyword">if</span> <span class="built_in">filereadable</span>(<span class="string">"workspace.vim"</span>)</div><div class="line">    <span class="keyword">source</span> workspace.<span class="keyword">vim</span></div><div class="line"><span class="keyword">endif</span></div><div class="line"></div><div class="line"><span class="comment">" 设置vim启动时自动读取session及viminfo信息</span></div><div class="line"><span class="keyword">if</span> <span class="built_in">filereadable</span>(<span class="string">"workspace.session"</span>)</div><div class="line">    <span class="keyword">source</span> workspace.session</div><div class="line"><span class="keyword">endif</span></div><div class="line"><span class="keyword">if</span> <span class="built_in">filereadable</span>(<span class="string">"workspace.viminfo"</span>)</div><div class="line">    <span class="keyword">rviminfo</span> workspace.viminfo</div><div class="line"><span class="keyword">endif</span></div><div class="line"></div><div class="line"><span class="comment">" 设置vim退出时自动保存工程配置</span></div><div class="line"><span class="keyword">if</span> <span class="built_in">filereadable</span>(<span class="string">"workspace.vim"</span>)  <span class="comment">"表示需要保存，防止不必要的保存</span></div><div class="line">    <span class="keyword">au</span> VimLeave * <span class="keyword">mksession</span> workspace.session </div><div class="line">    <span class="keyword">au</span> VimLeave * <span class="keyword">wviminfo</span> workspace.viminfo </div><div class="line"><span class="keyword">endif</span></div></pre></td></tr></table></figure>
<h2 id="使用ctags"><a href="#使用ctags" class="headerlink" title="使用ctags"></a>使用ctags</h2><p>使用ctags命令：ctags -R . 命令生成tags文件，然后使用set tags=tags导入，可以使用vimrc设置自动导入</p>
<h2 id="缓冲区及文件、tag查找"><a href="#缓冲区及文件、tag查找" class="headerlink" title="缓冲区及文件、tag查找"></a>缓冲区及文件、tag查找</h2><p>项目中，当打开的文件太多说，知道当前打开的文件名是一项有用的功能，这个可以通过minibufexpl实现，效果如下：<br><img src="http://odix5916v.bkt.clouddn.com/vim_minibufexpl.png?imageView2/2/w/300" alt="pic"></p>
<p>vim中可以使用lookupfile插件进行tag, buffer, 文件及目录搜索，其对应的指令分别如下：</p>
<ul>
<li>缓冲区查找：LUBufs</li>
<li>目录查找：LUWalk</li>
<li>tag查找：LUTags </li>
</ul>
<h2 id="cscope使用"><a href="#cscope使用" class="headerlink" title="cscope使用"></a>cscope使用</h2><p>如果你需求查找函数调用或者变量使用的地方，ctags就无能为力了，这时候就得用cscope了。<br>用法：<br>cscope默认只生成.c文件的索引，如果是c++或者java等其他语言，需要自行增加索引文件表。可以使用如下命令：<br><code>find . -name &quot;*.h&quot; -o -name &quot;*.c&quot; -o -name &quot;*.cc&quot; &gt; cscope.files</code><br><code>cscope -bkq -i cscope.files</code><br>然后在工程vim中执行: <code>cscope add cscope.out</code>,导入cscope索引。之后就可以使用cscope操作了，其操作命令如下：<br>man cscope或者vim中执行help cscope  </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> s ---- 查找C语言符号，即查找函数名、宏、枚举值等出现的地方  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> g ---- 查找函数、宏、枚举等定义的位置，类似ctags所提供的功能  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> d ---- 查找本函数调用的函数  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> <span class="keyword">c</span> ---- 查找调用本函数的函数  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> t ---- 查找指定的字符串  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> <span class="keyword">e</span> ---- 查找egrep模式，相当于egrep功能，但查找速度快多了  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> <span class="keyword">f</span> ---- 查找并打开文件，类似<span class="keyword">vim</span>的<span class="keyword">find</span>功能  </div><div class="line">：<span class="keyword">cs</span> <span class="keyword">find</span> i ---- 查找包含本文件的文件</div></pre></td></tr></table></figure>
<p>使用时，可以把cscope的查找结果输出到quickfix窗口，需要在~/.vimrc中加入下面这行：<br>set cscopequickfix=s-,c-,d-,i-,t-,e-<br>p.s:<br>打开quickfix —— copen<br>关闭quickfix —— cclose<br>查找下一个 —— cn<br>查找上一个 —— cp<br>浏览位置间跳转 —— ctrl+o(往前)，ctrl+i(往后)  </p>
<h2 id="自动刷新工程中的tags"><a href="#自动刷新工程中的tags" class="headerlink" title="自动刷新工程中的tags"></a>自动刷新工程中的tags</h2><p>未完待续</p>
<p>可以点击<a href="https://github.com/chhy2009/my_vimconfig" target="_blank" rel="external">my vimrc</a>访问我的vimrc配置</p>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/">vim</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/coding/">编程</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-OperateSystem/software-of-mac" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/18/OperateSystem/software-of-mac/" class="article-date">
  	<time datetime="2016-12-18T13:19:48.000Z" itemprop="datePublished">2016-12-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/18/OperateSystem/software-of-mac/">mac下的各种常用软件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mac-下的UML软件"><span class="toc-text">Mac 下的UML软件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#torrent下载软件"><span class="toc-text">torrent下载软件</span></a></li></ol>
</div>

         
        <h2 id="Mac-下的UML软件"><a href="#Mac-下的UML软件" class="headerlink" title="Mac 下的UML软件"></a>Mac 下的UML软件</h2><ol>
<li><a href="http://www.processon.com/diagraming/58568c76e4b04ce38789efa7" target="_blank" rel="external">Processon</a><br>一款在线绘图软件，只需要浏览器及网络即可使用</li>
<li><a href="http://argouml.tigris.org" target="_blank" rel="external">ArgoUML</a></li>
</ol>
<h2 id="torrent下载软件"><a href="#torrent下载软件" class="headerlink" title="torrent下载软件"></a>torrent下载软件</h2><ol>
<li>utorrent</li>
</ol>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software/">software</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/essay/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-OpenSource/openssl-cmd" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/18/OpenSource/openssl-cmd/" class="article-date">
  	<time datetime="2016-12-18T03:15:15.000Z" itemprop="datePublished">2016-12-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/18/OpenSource/openssl-cmd/">openssl命令</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#生成证书"><span class="toc-text">生成证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#证书签名"><span class="toc-text">证书签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#证书吊销"><span class="toc-text">证书吊销</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#验证证书"><span class="toc-text">验证证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成RSA密钥对"><span class="toc-text">生成RSA密钥对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA加密算法"><span class="toc-text">RSA加密算法</span></a></li></ol>
</div>

         
        <h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><p>请参考<a href="http://blog.csdn.net/codingcs/article/details/51816115" target="_blank" rel="external">使用openssl生成证书</a></p>
<h2 id="证书签名"><a href="#证书签名" class="headerlink" title="证书签名"></a>证书签名</h2><p>请参考<a href="http://blog.csdn.net/codingcs/article/details/51816115" target="_blank" rel="external">使用openssl生成证书</a></p>
<h2 id="证书吊销"><a href="#证书吊销" class="headerlink" title="证书吊销"></a>证书吊销</h2><ol>
<li>吊销证书<br><code>openssl ca －revoke newcerts/username.pem -config openssl.cnf</code></li>
<li>重新生成证书吊销列表<br><code>openssl ca -config openssl.cnf -gencrl -out crl/ca.crl</code></li>
<li>生成hash码链接文件<br> ln -s ca.crl `openssl crl -hash -noout -in ca.crl`.r0</li>
<li>把ca.crl及hash码文件拷贝到应用证书吊销列表文件夹</li>
</ol>
<h2 id="验证证书"><a href="#验证证书" class="headerlink" title="验证证书"></a>验证证书</h2><p><code>openssl verify -CAfile cacert.pem servercert.pem</code></p>
<h2 id="生成RSA密钥对"><a href="#生成RSA密钥对" class="headerlink" title="生成RSA密钥对"></a>生成RSA密钥对</h2><ol>
<li>生成私钥<br><code>openssl genrsa -out rsa_private_key.pem 1024</code></li>
<li>生成公钥<br><code>openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</code></li>
<li>查看私钥信息<br><code>openssl rsa -in rsa_private_key.pem -text -noout</code></li>
</ol>
<p>示例如下，其中生成的moduls前两位需要去掉：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">$ openssl rsa -<span class="keyword">in</span> rsa_private_key.pem -text -noout</div><div class="line">Private-<span class="string">Key:</span> (<span class="number">512</span> bit)</div><div class="line"><span class="string">modulus:</span></div><div class="line"><span class="symbol">    00:</span><span class="string">cb:</span><span class="number">23</span>:<span class="number">6</span><span class="string">d:</span><span class="number">74</span>:<span class="string">e6:</span><span class="string">bf:</span><span class="string">cb:</span><span class="number">89</span>:<span class="string">a1:</span><span class="number">66</span>:<span class="number">52</span>:<span class="string">ca:</span><span class="number">5</span><span class="string">f:</span><span class="string">c2:</span></div><div class="line"><span class="symbol">    76:</span><span class="number">23</span>:<span class="number">30</span>:<span class="number">60</span>:<span class="number">52</span>:<span class="string">bc:</span><span class="string">bd:</span><span class="number">20</span>:<span class="string">a6:</span><span class="number">25</span>:<span class="string">cc:</span><span class="number">8</span><span class="string">e:</span><span class="number">61</span>:<span class="number">73</span>:<span class="number">46</span>:</div><div class="line"><span class="symbol">    01:</span><span class="string">f4:</span><span class="number">60</span>:<span class="number">09</span>:<span class="number">45</span>:<span class="number">2</span><span class="string">a:</span><span class="string">db:</span><span class="string">fa:</span><span class="number">34</span>:<span class="number">33</span>:<span class="number">06</span>:<span class="number">8</span><span class="string">b:</span><span class="number">61</span>:<span class="number">85</span>:<span class="number">8</span><span class="string">e:</span></div><div class="line"><span class="symbol">    c7:</span><span class="number">1</span><span class="string">c:</span><span class="number">1</span><span class="string">c:</span><span class="number">77</span>:<span class="number">1</span><span class="string">d:</span><span class="string">cd:</span><span class="string">f2:</span><span class="string">ab:</span><span class="string">e2:</span><span class="string">af:</span><span class="string">f2:</span><span class="string">e8:</span><span class="string">c9:</span><span class="number">03</span>:<span class="string">ec:</span></div><div class="line"><span class="symbol">    18:</span><span class="number">2</span><span class="string">a:</span><span class="number">72</span>:<span class="string">d9:</span>af</div><div class="line"><span class="string">publicExponent:</span> <span class="number">65537</span> (<span class="number">0x10001</span>)</div><div class="line"><span class="string">privateExponent:</span></div><div class="line"><span class="symbol">    62:</span><span class="string">c7:</span><span class="number">2</span><span class="string">b:</span><span class="number">66</span>:<span class="number">78</span>:<span class="string">fe:</span><span class="number">32</span>:<span class="number">7</span><span class="string">f:</span><span class="number">0</span><span class="string">e:</span><span class="number">58</span>:<span class="string">af:</span><span class="number">51</span>:<span class="number">71</span>:<span class="number">17</span>:<span class="number">22</span>:</div><div class="line"><span class="symbol">    53:</span><span class="number">22</span>:<span class="number">26</span>:<span class="string">f4:</span><span class="number">94</span>:<span class="number">8</span><span class="string">a:</span><span class="number">72</span>:<span class="string">e1:</span><span class="string">d7:</span><span class="string">e7:</span><span class="number">8</span><span class="string">c:</span><span class="number">24</span>:<span class="number">9</span><span class="string">e:</span><span class="string">e5:</span><span class="number">1</span><span class="string">f:</span></div><div class="line"><span class="symbol">    f6:</span><span class="number">30</span>:<span class="number">0</span><span class="string">e:</span><span class="string">e3:</span><span class="string">e5:</span><span class="string">bc:</span><span class="string">d2:</span><span class="number">4</span><span class="string">f:</span><span class="number">79</span>:<span class="string">c5:</span><span class="number">21</span>:<span class="number">72</span>:<span class="string">dd:</span><span class="number">3</span><span class="string">f:</span><span class="number">9</span><span class="string">b:</span></div><div class="line"><span class="symbol">    b5:</span><span class="number">71</span>:<span class="number">52</span>:<span class="number">1</span><span class="string">c:</span><span class="number">0</span><span class="string">e:</span><span class="string">d7:</span><span class="number">0</span><span class="string">e:</span><span class="string">d6:</span><span class="number">46</span>:<span class="string">bd:</span><span class="string">dc:</span><span class="string">af:</span><span class="string">d2:</span><span class="number">23</span>:<span class="number">95</span>:</div><div class="line"><span class="symbol">    cd:</span><span class="number">08</span>:<span class="number">18</span>:a1</div><div class="line"><span class="string">prime1:</span></div><div class="line"><span class="symbol">    00:</span><span class="string">ec:</span><span class="number">9</span><span class="string">a:</span><span class="number">67</span>:<span class="string">ec:</span><span class="string">ae:</span><span class="string">cd:</span><span class="number">9</span><span class="string">e:</span><span class="number">48</span>:<span class="string">f9:</span><span class="string">fd:</span><span class="number">27</span>:<span class="string">f1:</span><span class="number">01</span>:<span class="string">fa:</span></div><div class="line"><span class="symbol">    14:</span><span class="number">38</span>:<span class="number">5</span><span class="string">b:</span><span class="string">f2:</span><span class="number">55</span>:<span class="string">a1:</span><span class="number">1</span><span class="string">e:</span><span class="number">16</span>:<span class="number">42</span>:<span class="string">c0:</span><span class="number">31</span>:<span class="string">a5:</span><span class="string">af:</span><span class="string">b9:</span><span class="number">22</span>:</div><div class="line"><span class="symbol">    f9:</span><span class="number">37</span>:dd</div><div class="line"><span class="string">prime2:</span></div><div class="line"><span class="symbol">    00:</span><span class="string">db:</span><span class="string">ca:</span><span class="string">b2:</span><span class="number">38</span>:<span class="number">54</span>:<span class="string">d8:</span><span class="number">64</span>:<span class="string">d3:</span><span class="number">74</span>:<span class="string">db:</span><span class="string">bf:</span><span class="string">a2:</span><span class="number">00</span>:<span class="string">fc:</span></div><div class="line"><span class="symbol">    c8:</span><span class="number">45</span>:<span class="string">d8:</span><span class="string">f4:</span><span class="number">1</span><span class="string">b:</span><span class="number">05</span>:<span class="number">32</span>:<span class="string">c5:</span><span class="number">29</span>:<span class="number">8</span><span class="string">f:</span><span class="number">56</span>:<span class="number">70</span>:<span class="number">0</span><span class="string">a:</span><span class="string">c2:</span><span class="number">50</span>:</div><div class="line"><span class="symbol">    56:</span><span class="number">24</span>:fb</div><div class="line"><span class="string">exponent1:</span></div><div class="line"><span class="symbol">    31:</span><span class="string">ab:</span><span class="number">60</span>:<span class="number">71</span>:<span class="string">c1:</span><span class="number">68</span>:<span class="number">8</span><span class="string">c:</span><span class="string">f8:</span><span class="number">08</span>:<span class="string">f2:</span><span class="string">ea:</span><span class="number">35</span>:<span class="string">a0:</span><span class="number">12</span>:<span class="number">9</span><span class="string">d:</span></div><div class="line"><span class="symbol">    b8:</span><span class="number">0</span><span class="string">f:</span><span class="number">25</span>:<span class="number">5</span><span class="string">a:</span><span class="number">70</span>:<span class="number">8</span><span class="string">e:</span><span class="number">5</span><span class="string">e:</span><span class="number">61</span>:<span class="string">f8:</span><span class="string">f2:</span><span class="string">f3:</span><span class="number">33</span>:<span class="number">66</span>:<span class="number">8</span><span class="string">c:</span><span class="number">3</span><span class="string">f:</span></div><div class="line"><span class="symbol">    01:</span><span class="number">49</span></div><div class="line"><span class="string">exponent2:</span></div><div class="line"><span class="symbol">    3f:</span><span class="number">6</span><span class="string">a:</span><span class="number">4</span><span class="string">b:</span><span class="number">63</span>:<span class="number">9</span><span class="string">f:</span><span class="number">6</span><span class="string">f:</span><span class="number">54</span>:<span class="number">20</span>:<span class="number">02</span>:<span class="string">be:</span><span class="number">88</span>:<span class="number">9</span><span class="string">b:</span><span class="number">18</span>:<span class="number">87</span>:<span class="string">d6:</span></div><div class="line"><span class="symbol">    cc:</span><span class="string">f8:</span><span class="number">5</span><span class="string">c:</span><span class="string">ee:</span><span class="number">12</span>:<span class="string">e0:</span><span class="string">e4:</span><span class="number">2</span><span class="string">c:</span><span class="number">2</span><span class="string">a:</span><span class="number">94</span>:<span class="number">38</span>:<span class="string">fd:</span><span class="number">91</span>:<span class="string">b5:</span><span class="number">16</span>:</div><div class="line"><span class="symbol">    35:</span>d3</div><div class="line"><span class="string">coefficient:</span></div><div class="line"><span class="symbol">    7f:</span><span class="number">68</span>:<span class="number">40</span>:<span class="number">1</span><span class="string">f:</span><span class="number">63</span>:<span class="number">8</span><span class="string">e:</span><span class="number">60</span>:<span class="string">f3:</span><span class="number">0</span><span class="string">e:</span><span class="string">e6:</span><span class="string">e0:</span><span class="number">9</span><span class="string">c:</span><span class="number">84</span>:<span class="string">ce:</span><span class="number">3</span><span class="string">e:</span></div><div class="line"><span class="symbol">    89:</span><span class="number">1</span><span class="string">b:</span><span class="string">e3:</span><span class="number">62</span>:<span class="number">01</span>:<span class="number">23</span>:<span class="number">44</span>:<span class="number">70</span>:<span class="number">94</span>:<span class="string">ff:</span><span class="string">ea:</span><span class="string">c1:</span><span class="string">b5:</span><span class="string">d4:</span><span class="string">a4:</span></div><div class="line"><span class="symbol">    ac:</span><span class="number">50</span></div></pre></td></tr></table></figure>
<h2 id="RSA加密算法"><a href="#RSA加密算法" class="headerlink" title="RSA加密算法"></a>RSA加密算法</h2><ol>
<li>生成密钥对，即RAS结构</li>
<li>公钥持有端使用RSA_public_encrypt和RSA_public_decrypt进行加解密（openssl中的函数）</li>
<li>私钥持有端使用RSA_private_encrypt和RSA_private_decrypt进行加解密</li>
</ol>

      
    </div>
    
      
  <!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
      _background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
      <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
        <br>
      ------------------------------------------------------------------------------------------------------------------------------
      <br>

    <a href="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-wechat-Pay.png2F25A87E40C037BB93F7CFE2404ABD45.jpg" title="微信打赏 Colin" height="190px" width="auto"/>
    </a>
        
        &nbsp;&nbsp;

    <a href="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
      <img src="http://odix5916v.bkt.clouddn.com/my-Ali-Pay.png8E7371B4868D647EFBAA826AD894B14F.jpg" title="支付宝打赏 Colin" height="190px" width="auto"/>
    </a>

    <span class="donate_txt">
      Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
    </span>

  </div>
  <!-- /donate guide -->

  <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
    
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openssl/">openssl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/coding/">编程</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 chenhy
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <span id="busuanzi_container_site_pv">
      本站总访问量<span id="busuanzi_value_site_pv"></span>次
    </span>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		root: /
	}
</script>
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>